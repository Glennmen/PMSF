/*
 pmsf 2017-06-27 
*/

"use strict";function addMainWorker(a){var s='\n     <div id="worker_'+a+'" class="worker">\n       <span id="name_'+a+'" class="name"></span>\n       <span id="method_'+a+'" class="method"></span>\n       <span id="message_'+a+'" class="message"></span>\n     </div>\n   ';$(s).appendTo("#status_container"),addTable(a)}function processMainWorker(a,s){var e=hashFnv32a(s.worker_name,!0);0===$("#worker_"+e).length&&addMainWorker(e),$("#name_"+e).html(s.worker_name),$("#method_"+e).html("("+s.method+")"),$("#message_"+e).html(s.message.replace(/\n/g,"<br>"))}function addWorker(a,s){var e='\n     <div id="row_'+s+'" class="status_row">\n       <div id="username_'+s+'" class="status_cell"/>\n       <div id="success_'+s+'"  class="status_cell"/>\n       <div id="fail_'+s+'"     class="status_cell"/>\n       <div id="no_items_'+s+'"  class="status_cell"/>\n       <div id="skip_'+s+'"     class="status_cell"/>\n       <div id="captchas_'+s+'" class="status_cell"/>\n       <div id="lastmod_'+s+'"  class="status_cell"/>\n       <div id="message_'+s+'"  class="status_cell"/>\n     </div>\n   ';$(e).appendTo("#table_"+a)}function processWorker(a,s){var e=hashFnv32a(s.username,!0),t;if(groupByWorker){if(t=hashFnv32a(s.worker_name,!0),0===$("#table_"+t).length)return}else t="global",0===$("#table_global").length&&addTable("global");0===$("#row_"+e).length&&addWorker(t,e);var n=new Date(s.last_modified);n=n.getHours()+":"+("0"+n.getMinutes()).slice(-2)+":"+("0"+n.getSeconds()).slice(-2)+" "+n.getDate()+" "+monthArray[n.getMonth()]+" "+n.getFullYear(),$("#username_"+e).html(s.username),$("#success_"+e).html(s.success),$("#fail_"+e).html(s.fail),$("#no_items_"+e).html(s.no_items),$("#skip_"+e).html(s.skip),$("#captchas_"+e).html(s.captcha),$("#lastmod_"+e).html(n),$("#message_"+e).html(s.message)}function parseResult(a){groupByWorker&&$.each(a.main_workers,processMainWorker),$.each(a.workers,processWorker)}function addTable(a){var s='\n     <div class="status_table" id="table_'+a+'">\n       <div class="status_row header">\n         <div class="status_cell">\n           Username\n         </div>\n         <div class="status_cell">\n           Success\n         </div>\n         <div class="status_cell">\n           Fail\n         </div>\n         <div class="status_cell">\n           No Items\n         </div>\n         <div class="status_cell">\n           Skipped\n         </div>\n         <div class="status_cell">\n           Captchas\n         </div>\n         <div class="status_cell">\n           Last Modified\n         </div>\n         <div class="status_cell">\n           Message\n         </div>\n       </div>\n     </div>\n   ';(s=$(s)).appendTo("#status_container"),s.find(".status_row.header .status_cell").click(tableSort)}function tableSort(){var a=$(this).parents(".status_table").eq(0),s=a.find(".status_row:gt(0)").toArray().sort(compare($(this).index()));this.asc=!this.asc,this.asc||(s=s.reverse());for(var e=0;e<s.length;e++)a.append(s[e])}function getCellValue(a,s){return $(a).children(".status_cell").eq(s).html()}function compare(a){return function(s,e){var t=getCellValue(s,a),n=getCellValue(e,a);return $.isNumeric(t)&&$.isNumeric(n)?t-n:t.localeCompare(n)}}function updateStatus(){loadRawData().done(function(a){parseResult(a)}).always(function(){var a=new Date-lastRawUpdateTime,s=Math.max(minUpdateDelay-a,1);window.setTimeout(updateStatus,s)})}function hashFnv32a(a,s,e){var t,n,r=void 0===e?2166136261:e;for(t=0,n=a.length;t<n;t++)r^=a.charCodeAt(t),r+=(r<<1)+(r<<4)+(r<<7)+(r<<8)+(r<<24);return s?("0000000"+(r>>>0).toString(16)).substr(-8):r>>>0}function loadRawData(){return $.ajax({url:"status",type:"post",data:{password:statusPagePassword},dataType:"json",beforeSend:function a(){if(rawDataIsLoading)return!1;rawDataIsLoading=!0},complete:function a(){rawDataIsLoading=!1}})}var monthArray=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],rawDataIsLoading=!1,statusPagePassword=!1,groupByWorker=!0,minUpdateDelay=1e3,lastRawUpdateTime=new Date;$(document).ready(function(){$("#password").focus(),$("#password_form").submit(function(a){a.preventDefault(),statusPagePassword=$("#password").val(),loadRawData().done(function(a){"ok"===a.login?($(".status_form").remove(),parseResult(a),window.setTimeout(updateStatus,minUpdateDelay)):($(".status_form").effect("bounce"),$("#password").focus())})}),$("#groupbyworker-switch").change(function(){groupByWorker=this.checked,$("#status_container .status_table").remove(),$("#status_container .worker").remove(),statusPagePassword&&updateStatus()})});
//# sourceMappingURL=status.min.js.map