/*
 pmsf 2017-06-27 
*/

"use strict";function loadRawData(){return $.ajax({url:"raw_data.php",type:"GET",data:{pokemon:!1,pokestops:!1,gyms:!1,scanned:!1,seen:!0,duration:$("#duration").val()},dataType:"json",beforeSend:function e(){if(rawDataIsLoading)return!1;rawDataIsLoading=!0},complete:function e(){rawDataIsLoading=!1}})}function addElement(e,a){jQuery("<div/>",{id:"seen_"+e,class:"item"}).appendTo("#seen_container"),jQuery("<div/>",{id:"seen_"+e+"_base",class:"container"}).appendTo("#seen_"+e);var n=jQuery("<div/>",{class:"image"}).appendTo("#seen_"+e+"_base");jQuery("<i/>",{class:"pokemon-sprite n"+e}).appendTo(n);var t=jQuery("<div/>",{class:"info"}).appendTo("#seen_"+e+"_base");jQuery("<div/>",{id:"name_"+e,class:"name"}).appendTo(t),jQuery("<a/>",{id:"link_"+e,href:"http://www.pokemon.com/us/pokedex/"+e,target:"_blank",title:"View in Pokedex",text:a}).appendTo("#name_"+e),jQuery("<div/>",{id:"seen_"+e+"_details",class:"details"}).appendTo("#seen_"+e),jQuery("<div/>",{id:"count_"+e,class:"seen"}).appendTo("#seen_"+e+"_details"),jQuery("<div/>",{id:"lastseen_"+e,class:"lastseen"}).appendTo("#seen_"+e+"_details"),jQuery("<div/>",{id:"location_"+e,class:"location"}).appendTo("#seen_"+e+"_details"),jQuery("<a/>",{href:"javascript:void(0);",onclick:"javascript:showOverlay("+e+");",text:"All Locations"}).appendTo("#seen_"+e+"_details")}function processSeen(e){var a,n=e.total,t=[];for(e.pokemon.sort(function(e,a){var n=document.getElementById("sort"),t=document.getElementById("order");if("desc"===t.options[t.selectedIndex].value){var o=a;a=e,e=o}return"id"===n.options[n.selectedIndex].value?e.pokemon_id-a.pokemon_id:"name"===n.options[n.selectedIndex].value?e.pokemon_name.toLowerCase()<a.pokemon_name.toLowerCase()?-1:e.pokemon_name.toLowerCase()>a.pokemon_name.toLowerCase()?1:0:e.count===a.count?a.pokemon_id-e.pokemon_id:e.count-a.count}),a=e.pokemon.length-1;a>=0;a--){var o=e.pokemon[a],s=(o.count/n*100).toFixed(4),p=new Date(o.disappear_time);p=p.getHours()+":"+("0"+p.getMinutes()).slice(-2)+":"+("0"+p.getSeconds()).slice(-2)+" "+p.getDate()+" "+monthArray[p.getMonth()]+" "+p.getFullYear();var i=(1*o.latitude).toFixed(7)+", "+(1*o.longitude).toFixed(7);$("#seen_"+o.pokemon_id).length||addElement(o.pokemon_id,o.pokemon_name),$("#count_"+o.pokemon_id).html("<strong>Seen:</strong> "+o.count.toLocaleString()+" ("+s+"%)"),$("#lastseen_"+o.pokemon_id).html("<strong>Last Seen:</strong> "+p),$("#location_"+o.pokemon_id).html("<strong>Location:</strong> "+i),$("#seen_"+o.pokemon_id).show(),document.getElementById("seen_container").insertBefore(document.getElementById("seen_"+o.pokemon_id),document.getElementById("seen_container").childNodes[0]),t.push(o.pokemon_id)}for(a=1;a<=totalPokemon;a++)t.indexOf(a)<0&&$("#seen_"+a).hide();document.getElementById("seen_total").innerHTML="Total: "+n.toLocaleString()}function updateStatMap(e){var a=document.getElementById("duration"),n="Pokemon Seen in "+a.options[a.selectedIndex].text;$("#seen_header").html()!==n&&($("#seen_container").hide(),$("#loading").show(),$("#seen_header").html(""),$("#seen_total").html("")),loadRawData().done(function(e){processSeen(e.seen),$("#seen_header").html()!==n&&($("#seen_header").html(n),$("#loading").hide(),$("#seen_container").show())})}function loadDetails(){return $.ajax({url:"raw_data.php",type:"GET",data:{pokemon:!1,pokestops:!1,gyms:!1,scanned:!1,appearances:!0,pokemonid:pokemonid,duration:$("#duration").val()},dataType:"json",beforeSend:function e(){if(detailsLoading)return!1;detailsLoading=!0},complete:function e(){detailsLoading=!1}})}function loadAppearancesTimes(e,a){return $.ajax({url:"raw_data.php",type:"GET",data:{pokemon:!1,pokestops:!1,gyms:!1,scanned:!1,appearances:!1,appearancesDetails:!0,pokemonid:e,spawnpoint_id:a,duration:$("#duration").val()},dataType:"json",beforeSend:function e(){if(appearancesTimesLoading)return!1;appearancesTimesLoading=!0},complete:function e(){appearancesTimesLoading=!1}})}function showTimes(e){appearanceTab(mapData.appearances[e.spawnpointId]).then(function(e){$("#times_list").html(e),$("#times_list").show()})}function closeTimes(){$("#times_list").hide(),detailsPersist=!1}function addListeners(e){return e.addListener("click",function(){showTimes(e),detailsPersist=!0}),e.addListener("mouseover",function(){showTimes(e)}),e.addListener("mouseout",function(){detailsPersist||$("#times_list").hide()}),e}function initMap(){map=new google.maps.Map(document.getElementById("location_map"),{zoom:16,center:{lat:centerLat,lng:centerLng},fullscreenControl:!1,streetViewControl:!1,mapTypeControl:!0,clickableIcons:!1,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:google.maps.ControlPosition.RIGHT_TOP,mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.HYBRID,"nolabels_style","dark_style","style_light2","style_pgo","dark_style_nl","style_light2_nl","style_pgo_nl","style_pgo_day","style_pgo_night","style_pgo_dynamic"]}});var e=new google.maps.StyledMapType(noLabelsStyle,{name:"No Labels"});map.mapTypes.set("nolabels_style",e);var a=new google.maps.StyledMapType(darkStyle,{name:"Dark"});map.mapTypes.set("dark_style",a);var n=new google.maps.StyledMapType(light2Style,{name:"Light2"});map.mapTypes.set("style_light2",n);var t=new google.maps.StyledMapType(pGoStyle,{name:"PokemonGo"});map.mapTypes.set("style_pgo",t);var o=new google.maps.StyledMapType(darkStyleNoLabels,{name:"Dark (No Labels)"});map.mapTypes.set("dark_style_nl",o);var s=new google.maps.StyledMapType(light2StyleNoLabels,{name:"Light2 (No Labels)"});map.mapTypes.set("style_light2_nl",s);var p=new google.maps.StyledMapType(pGoStyleNoLabels,{name:"PokemonGo (No Labels)"});map.mapTypes.set("style_pgo_nl",p);var i=new google.maps.StyledMapType(pGoStyleDay,{name:"PokemonGo Day"});map.mapTypes.set("style_pgo_day",i);var l=new google.maps.StyledMapType(pGoStyleNight,{name:"PokemonGo Night"});map.mapTypes.set("style_pgo_night",l);var r=(new Date).getHours(),d=r>=6&&r<19?i:l;map.mapTypes.set("style_pgo_dynamic",d),map.addListener("maptypeid_changed",function(e){Store.set("map_style",this.mapTypeId)}),map.setMapTypeId(Store.get("map_style")),google.maps.event.addListener(map,"idle",updateStatMap),mapLoaded=!0,google.maps.event.addListener(map,"zoom_changed",function(){redrawAppearances(mapData.appearances)})}function resetMap(){$.each(mapData.appearances,function(e,a){mapData.appearances[e].marker.setMap(null),delete mapData.appearances[e]}),heatmapPoints=[],heatmap&&heatmap.setMap(null)}function showOverlay(e){return mapLoaded||initMap(),resetMap(),pokemonid=e,$("#location_details").show(),location.hash="overlay_"+pokemonid,updateDetails(),!1}function closeOverlay(){return $("#location_details").hide(),closeTimes(),location.hash="",!1}function processAppearance(e,a){var n=a.spawnpoint_id;n in mapData.appearances||(a.marker&&a.marker.setMap(null),a.marker=setupPokemonMarker(a,map,!0),addListeners(a.marker),a.marker.spawnpointId=n,mapData.appearances[n]=a),heatmapPoints.push({location:new google.maps.LatLng(a.latitude,a.longitude),weight:parseFloat(a.count)})}function redrawAppearances(e){$.each(e,function(a,n){var t=e[a];if(!t.hidden){var o=setupPokemonMarker(t,map,!0);t.marker.setMap(null),addListeners(o),o.spawnpointId=t.spawnpoint_id,e[a].marker=o}})}function appearanceTab(e){var a="";return loadAppearancesTimes(e.pokemon_id,e.spawnpoint_id).then(function(n){return $.each(n.appearancesTimes,function(e,n){var t=new Date(n-spawnTimeMs);t=t.getHours()+":"+("0"+t.getMinutes()).slice(-2)+":"+("0"+t.getSeconds()).slice(-2)+" "+t.getDate()+" "+monthArray[t.getMonth()]+" "+t.getFullYear(),a='<div class="row'+e%2+'">'+t+"</div>"+a}),'<div>\n                                <a href="javascript:closeTimes();">Close this tab</a>\n                        </div>\n                        <div class="row1">\n                                <strong>Lat:</strong> '+e.latitude.toFixed(7)+'\n                        </div>\n                        <div class="row0">\n                                <strong>Long:</strong> '+e.longitude.toFixed(7)+'\n                        </div>\n                        <div class="row1">\n                            <strong>Appearances:</strong> '+e.count.toLocaleString()+'\n                        </div>\n                        <div class="row0"><strong>Times:</strong></div>\n                        <div>\n                                '+a+"\n                        </div>"})}function updateDetails(){loadDetails().done(function(e){$.each(e.appearances,processAppearance),heatmap&&heatmap.setMap(null),heatmap=new google.maps.visualization.HeatmapLayer({data:heatmapPoints,map:map,radius:50})})}var monthArray=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],rawDataIsLoading=!1,totalPokemon=493,msPerMinute=6e4,spawnTimeMinutes=15,spawnTimeMs=msPerMinute*spawnTimeMinutes;updateStatMap();var detailsLoading=!1,appearancesTimesLoading=!1,pokemonid=0,mapLoaded=!1,detailsPersist=!1,map=null,heatmap=null,heatmapPoints=[];mapData.appearances={},location.href.match(/overlay_[0-9]+/g)&&showOverlay(location.href.replace(/^.*overlay_([0-9]+).*$/,"$1")),$("#nav select").select2({minimumResultsForSearch:1/0}).on("change",updateStatMap);
//# sourceMappingURL=statistics.min.js.map